<%= form_for(@challenge_participant) do |f| %>
  <% if @user.errors.any? %>
    <h5>Sorry. You weren't added to this challenge, due to the errors below.</h5>
    <div id="error_explanation">
      <ul>
      <% if !@user.blank? %>
        <% if @user.errors.any? %>
          <% @user.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        <% end %>
      <% end %>
      </ul>
    </div>
  <% end %>
  <% if @user.blank? || @user.id.blank? %>
    <p>Sign up for an account</p>
    <%= fields_for :user do |ff| %>
      <div class="field">
         <%= ff.label :email %><br />
         <%= ff.text_field :email %>
      </div>
      <div class="field">
         <%= ff.label :username %><br />
         <%= ff.text_field :username %>
      </div>
      <div class="field">
         <%= ff.label :first_name %><br />
         <%= ff.text_field :first_name %>
      </div>
      <div class="field">
         <%= ff.label :last_name %><br />
         <%= ff.text_field :last_name %>
      </div>
      <div class="field">
         <%= ff.label :profile_picture %><br />
         <%= ff.file_field :profile_picture %>
      </div>
      <div class="field">
         <%= ff.label :password %><br />
         <%= ff.password_field :password %>
      </div>
      <div class="field">
         <%= ff.label :password_confirmation %><br />
         <%= ff.password_field :password_confirmation %>
      </div>
    <% end %>
    <p>Already have an account?  Sign in.</p>
      <%= fields_for :login do |ff| %>
        <div class="field">
          <%= label_tag :email %><br />
          <%= text_field_tag :email %>
        </div>
        <div class="field">
          <%= label_tag :password %><br />
          <%= password_field_tag :password %>
        </div>
      <% end %>
  <% else %>
    <p>Sign me up!</p>
  <% end %>
  <div class="actions">
    <%= f.submit "Sign me up!" %>
  </div>
<% end %>
